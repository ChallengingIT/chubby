<!--
  ~ Copyright (c) 2023.  Marco Sciuto ITA for Innotek. All rights reserved.
  -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy">
  <title>[[${titoloPagina}]]</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link th:href="@{/css/bootstrap-5.1.3/bootstrap.min.css}" rel="stylesheet" />
  <link th:href="@{/font-awesome-5.15.4/css/all.css}" rel="stylesheet" />
  <link th:href="@{/css/style.css}" rel="stylesheet" />
  <link th:href="@{/css/mystyle.css}" rel="stylesheet" />
  <script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/bootstrap-5.1.3/bootstrap.bundle.js}"></script>
  <script type="text/javascript" th:src="@{/js/bootstrap-select.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/jquery.dropdown.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/main.js}"></script>
</head>
<body style="background-color: #ffb700">
  <div class="wrapper d-flex align-items-stretch">
    <div th:replace="~{sidebar}">  </div>

    <div id="content" class="p-4 p-md-5 pt-5">
      <h1 class="mb-4"><b>[[${titoloPagina}]]</b></h1>
      <div th:object="${cliente}">
        <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
        <input type="hidden" th:field="*{id}">
        <input type="hidden" th:field="*{denominazione}">
        <input type="hidden" th:field="*{provincia}">
        <input type="hidden" th:field="*{email}">
        <input type="hidden" th:field="*{status}">
        <input type="hidden" th:field="*{tipologia}">
        <input type="hidden" th:field="*{pec}">
        <input type="hidden" th:field="*{citta}">
        <input type="hidden" th:field="*{paese}">
        <input type="hidden" th:field="*{owner}">
        <input type="hidden" th:field="*{needs}">

        <div class="row text-center">
          <div class="col-sm-1"><br><br>
            <button type="button" class="btn btn-primary" style="border-radius:15px;" data-bs-toggle="modal" th:data-bs-target="|#modalNota|" title="Aggiungi Nota">
              <i class="fas fa-sticky-note"></i>
            </button><br><br>
            <button type="button" class="btn btn-primary" style="border-radius:15px;" data-bs-toggle="modal" th:data-bs-target="|#modalMail|" title="Notifica Invio Email">
              <i class="fa fa-envelope"></i>
            </button><br><br>
            <button type="button" class="btn btn-primary" style="border-radius:15px;" data-bs-toggle="modal" th:data-bs-target="|#modalPhone|" title="Notifica Telefonata">
              <i class="fa fa-phone"></i>
            </button>
          </div>
          <div class="col-sm-4">
            <h3 class="text-left pl-4" style="color:gray;">Informazioni Azienda</h3>
            <div id="information" class="bg-white" style="border-radius:10px;">
              <div class="row pb-2 pt-2 pl-4"><div class="col-sm-4">Nome:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.denominazione}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Settore:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.settoreMercato}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Email:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.email}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Pec:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.pec}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Owner:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.owner.nome}]] [[${cliente.owner.cognome}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Tipologia:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.tipologia}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">PI:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.pi}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Paese:</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.paese}]]</b></div></div>
              <div class="row pb-2 pl-4"><div class="col-sm-4">Citta':</div><div class="col-sm-8" style="color:black;"><b> [[${cliente.citta}]]</b></div></div>
            </div>
          </div>
          <div class="col-sm-7">
            <h3 class="text-left" style="color:gray;">Need</h3>
            <div class="row bg-white" style="border-radius:10px;">
              <span th:if=" ${cliente.needs.isEmpty()}">
                <span class="col-form-label pl-4">Il cliente non ha needs.</span>
              </span>
              <span th:unless=" ${cliente.needs.isEmpty()}">
                <div class="row pb-2 pt-2 pl-4" style="box-shadow: 0px 17px 0px -16px;">
                  <div class="col-sm-2">Priorità</div>
                  <div class="col-sm-10 text-left">Nome</div>
                </div>
                <span th:each="i : ${cliente.needs}">
                  <div class="row pt-2 pl-4">
                    <div class="col-sm-2" style="color:black;">[[${i.priorita}]]</div>
                    <div class="col-sm-10 text-left"><a th:href="@{'/need/match/' + ${i.id}}">[[${i.descrizione}]]</a></div>
                  </div>
                </span>
              </span>
            </div>
          </div>
        </div><br>
        <div class="row">
          <div class="col-sm-1"></div>
          <div class="col-sm-4">
            <h3 class="text-left pl-4" style="color:gray;">Comunicazioni</h3>
              <div class="bg-white" style="border-radius:10px;">
                <div class="row pb-2 pt-2 pl-4"><div class="col-sm-4">Need Aperti:</div><div class="col-sm-8 text-left" style="color:black;"> [[${needAperti}]]</div></div>
                <div class="row pb-2 pt-2 pl-4"><div class="col-sm-4">Need Vinti:</div><div class="col-sm-8 text-left" style="color:black;"> [[${needVinti}]]</div></div>
                <div class="row pb-2 pt-2 pl-4"><div class="col-sm-4">Ultima Attività:</div><div class="col-sm-8 text-left" style="color:black;"> [[${dataUltimaAttivita}]]</div></div>
              </div>
          </div>
          <div class="col-sm-7">
            <h2 class="text-left" style="color:gray;">Attività</h2>
            <div class="row border bg-white overflow-auto" style="border-radius:10px;">
                  <span th:if=" ${listaAttivita.isEmpty()}">
                    <span class="col-form-label pl-4">Non sono presenti attività</span>
                  </span>
                <span th:each="a : ${listaAttivita}">
                    <div class="row-form boxShadow">
                      <div class="form-row">
                        <div class="col-sm-3 text-center">
                          [[${a.tipologia.descrizione}]] di [[${a.owner.nome}]] [[${a.owner.cognome}]]
                        </div>
                        <div class="col-sm-3 text-center">
                           <span th:if="${a.keyPeople != null}">
                              Contatto: <span class="col-form-label" th:text="${a.keyPeople.nome}"></span>
                           </span>
                        </div>
                        <div class="col-sm-6 text-center">
                          Orario: [[${a.data}]]
                        </div>
                      </div>
                      <div class="form-row">
                        <span class="col-form-label" th:text="${a.note}"></span><br>
                      </div>
                    </div>
                  </span>
            </div>
          </div>
        </div><br>
        <div class="row">
          <div class="col-sm-1"></div>
          <div class="col-sm-4">
              <h2 class="text-left pl-4"  style="color:gray;">Contatti</h2>
            <div class="bg-white" style="border-radius:10px;">
                <span th:if=" ${cliente.keyPeoples.isEmpty()}">
                  <span class="col-form-label pl-4">Il cliente non ha contatti.</span>
                </span>
              <span th:each="j : ${cliente.keyPeoples}">
                    <div class="row-form boxShadow">
                      <div class="row pt-2 pl-4"><div class="col-sm-2">Nome:</div><div class="col-sm-8 text-left" style="color:black;">[[${j.nome}]]</div></div>
                      <div class="row pl-4"><div class="col-sm-2">Ruolo:</div><div class="col-sm-8 text-left" style="color:black;">[[${j.ruolo}]]</div></div>
                      <div class="row pl-4"><div class="col-sm-2">Email:</div><div class="col-sm-8 text-left" style="color:black;">
                        <a th:href="@{mailto:{to}(to=${j.email})}"> [[${j.email}]]</a>
                      </div></div>
                      <div class="row pl-4"><div class="col-sm-2">Cellulare: </div><div class="col-sm-8 text-left" style="color:black;">
                        <a th:href="@{callto:{to}(to=${j.cellulare})}"> [[${j.cellulare}]]</a>
                      </div></div>
                    </div>
                  </span>
            </div>
          </div>
          <div class="col-sm-7"></div>
        </div>

        <div class="row form-btn-wrapper mt-5 justify-content-center">
          <a th:href="@{/aziende/ricerca} + '?denominazione=' + ${cliente.denominazione}" class="col-5 btn btn-lg btn-secondary">Indietro</a>
        </div>
      </div>
    </div>
  </div>
  <div th:id="|modalMail|" class="modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Registrazione Email inviata</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form th:action="@{'/aziende/attivita/salva/'+ ${cliente.id} + '/2'}" method="post" th:object="${nuovaAttivita}">
          <input type="hidden" th:field="*{cliente}">
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group col">
                <label class="col-form-label">Owner</label>
                <select th:field="*{owner.id}" class="form-control select-medium" required>
                  <option th:value="null"> Seleziona un Owner</option>
                  <option th:each="k : ${listaOwner}" th:value="${k.getId()}"
                          th:text="${k.getDescrizione()}"></option>
                </select>
              </div>
              <div class="form-group col">
                <label class="col-form-label">Contatto</label>
                <select th:field="*{keyPeople.id}" class="form-control select-medium">
                  <option th:value="null"> Seleziona un Contatto</option>
                  <option th:each="j : ${cliente.keyPeoples}" th:value="${j.getId()}"
                          th:text="${j.getNome()}"></option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col">
                <label class="col-form-label">Commento</label>
                <textarea th:field="*{note}" class="form-control-textarea" maxlength="4000"
                          autocomplete="off"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Salva</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Indietro</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div th:id="|modalPhone|" class="modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Registrazione Chiamata effettuata</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form th:action="@{'/aziende/attivita/salva/'+ ${cliente.id} + '/3'}" method="post" th:object="${nuovaAttivita}">
          <input type="hidden" th:field="*{cliente}">
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group col">
                <label class="col-form-label">Owner</label>
                <select th:field="*{owner.id}" class="form-control select-medium" required>
                  <option th:value="null"> Seleziona un Owner</option>
                  <option th:each="k : ${listaOwner}" th:value="${k.getId()}"
                          th:text="${k.getDescrizione()}"></option>
                </select>
              </div>
              <div class="form-group col">
                <label class="col-form-label">Contatto</label>
                <select th:field="*{keyPeople.id}" class="form-control select-medium">
                  <option th:value="null"> Seleziona un Contatto</option>
                  <option th:each="j : ${cliente.keyPeoples}" th:value="${j.getId()}"
                          th:text="${j.getNome()}"></option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col">
                <label class="col-form-label">Commento</label>
                <textarea th:field="*{note}" class="form-control-textarea" maxlength="4000"
                          autocomplete="off"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Salva</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Indietro</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div th:id="|modalNota|" class="modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Inserimento nota attività</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form th:action="@{'/aziende/attivita/salva/'+ ${cliente.id} + '/1'}" method="post" th:object="${nuovaAttivita}">
          <input type="hidden" th:field="*{cliente}">
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group col">
                <label class="col-form-label">Owner</label>
                <select th:field="*{owner.id}" class="form-control select-medium" required>
                  <option th:value="null"> Seleziona un Owner</option>
                  <option th:each="k : ${listaOwner}" th:value="${k.getId()}"
                          th:text="${k.getDescrizione()}"></option>
                </select>
              </div>
              <div class="form-group col">
                <label for="education_level" class="col-form-label">Contatto</label>
                <select id="education_level" th:field="*{keyPeople.id}" class="form-control select-medium">
                  <option th:value="null"> Seleziona un Contatto</option>
                  <option th:each="j : ${cliente.keyPeoples}" th:value="${j.getId()}"
                          th:text="${j.getNome()}"></option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col">
                <label class="col-form-label">Commento</label>
                <textarea th:field="*{note}" class="form-control-textarea" maxlength="4000"
                          autocomplete="off"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Salva</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Indietro</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script type="text/javascript" th:src="@{/js/pages/azienda_dettaglio.js}"></script>
  <script type="text/javascript" th:src="@{/js/pages/history_back.js}"></script>
</body>
</html>